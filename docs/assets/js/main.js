"use strict";const form=document.querySelector(".js-form"),searchButton=document.querySelector("#js-button");let counter=document.querySelector("#fav-counter");const resetButton=document.querySelector(".js-reset"),searchInput=document.querySelector("#js-search-input"),ENDPOINT="http://api.tvmaze.com/search/shows?q=";let shows=[],favShows=[],showObject={},searchResultItems="";function getShowsFromApi(){fetch(ENDPOINT+""+searchInput.value).then(e=>e.json()).then(e=>{shows=[];for(let s of e){let e="";e=s.show.image?s.show.image.medium:"https://via.placeholder.com/210x295/ffffff/666666/?text=TV",showObject={name:s.show.name,image:e,id:s.show.id,fav:!1},shows.push(showObject)}renderShows(shows,"#shows-search-result",showObject),renderFavShows(favShows,"#fav-shows-container"),addListeners(),addListenerToFav()})}function renderFavShows(e,s){let o="";if(0===e.length)o+='<h2 class="show-title main__favs__title">No tienes ningún favorito.</h2>',resetButton.classList.add("hidden");else for(let s of e)o+=`<li class="show-container js-fav-show-container added-to-favs" id="${s.id}">`,o+='<div class="img-container">',o+=`<img class="show-image" src="${s.image}"/>`,o+="</div>",o+=`<h2 class="show-title">${s.name}</h2>`,o+='<h3 class="show-remove js-remove-fav"><i class="fa fa-trash" aria-hidden="true"></i></h3>',o+="</li>",resetButton.classList.remove("hidden");document.querySelector(s).innerHTML=o,addListenerToFav()}function renderShows(e,s){let o="";if(0===e.length)o+='<h2 class="show-title">No hemos encontrado naíta.</h2>';else if(!1===showObject.fav)for(let s of e)o+=`<li class="show-container js-main-show-container" id="${s.id}">`,o+='<div class="img-container">',o+=`<img class="show-image" src="${s.image}"/>`,o+="</div>",o+=`<h2 class="show-title">${s.name}</h2>`,o+="</li>";else{for(let s of e)o+=`<li class="show-container js-main-show-container added-to-favs" id="${s.id}">`,o+='<div class="img-container">',o+=`<img class="show-image" src="${s.image}"/>`,o+="</div>",o+=`<h2 class="show-title">${s.name}</h2>`,o+="</li>";addToFavs()}const t=document.querySelector(s);t.innerHTML=o,paintFavsInSearchResults(),searchResultItems=t.querySelectorAll(".js-main-show-container")}function addListeners(){const e=document.querySelectorAll(".js-main-show-container");for(const s of e)void 0!==s&&s.addEventListener("click",addToFavs);saveLocalStorage()}function addListenerToFav(){const e=document.querySelectorAll(".js-fav-show-container");for(const s of e)void 0!==s&&s.addEventListener("click",removeFromFavs)}function addToFavs(e){const s=e.currentTarget,o=parseInt(s.id),t=favShows.findIndex(e=>e.id===o);if(-1===t){const e=shows.find(e=>e.id===o);favShows.push(e),s.fav=!0,s.classList.add("added-to-favs")}else favShows.splice(t,1),s.classList.remove("added-to-favs");renderFavShows(favShows,"#fav-shows-container"),saveLocalStorage(),updateCounter()}function removeFromFavs(e){const s=e.currentTarget,o=parseInt(s.id),t=favShows.findIndex(e=>e.id===o),a=shows.findIndex(e=>e.id===o);favShows.splice(t,1),a>=0&&searchResultItems[a].classList.remove("added-to-favs"),renderFavShows(favShows,"#fav-shows-container"),saveLocalStorage(),updateCounter()}function paintFavsInSearchResults(){!0===searchResultItems.fav&&searchResultItems.classList.add("added-to-favs"),saveLocalStorage()}function saveLocalStorage(){localStorage.setItem("favs",JSON.stringify(favShows))}function painFromLocalStorage(){const e=JSON.parse(localStorage.getItem("favs"));null!==e&&(favShows=e)}function updateCounter(){counter.innerHTML=favShows.length+" favs",saveLocalStorage()}function handleClick(e){e.preventDefault(),getShowsFromApi()}function handleSubmit(e){e.preventDefault(),getShowsFromApi()}function reloadData(){painFromLocalStorage(),renderFavShows(favShows,"#fav-shows-container"),addListenerToFav(),updateCounter()}function resetFavs(){localStorage.removeItem("favs"),location.reload()}painFromLocalStorage(),resetButton.addEventListener("click",resetFavs),searchButton.addEventListener("click",handleClick),form.addEventListener("submit",handleSubmit),document.addEventListener("DOMContentLoaded",reloadData);const click=document.querySelector(".click"),section=document.querySelector(".js-hide-favs"),arrowDown=document.querySelector(".js-arrow-down"),arrowUp=document.querySelector(".js-arrow-up");function displayArrow(e){e.preventDefault(),section.classList.toggle("hidden"),arrowUp.classList.toggle("hidden"),arrowDown.classList.toggle("hidden")}click.addEventListener("click",displayArrow);